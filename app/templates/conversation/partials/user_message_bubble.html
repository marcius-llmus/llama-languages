<div hx-swap-oob="beforeend:#chat-log" id="user-message-{{ turn_id }}" class="flex items-start space-x-3 justify-end">
    <div class="flex-1 max-w-lg flex flex-col items-end">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg rounded-tr-none px-4 pt-3 pb-11 shadow-sm relative min-w-[150px]">
            <p id="user-message-text-{{ turn_id }}" class="min-h-[24px]">{{ message }}</p> {# For audio, this starts empty and is filled by streaming tokens #}
            {% if not is_conversational %}
            <div id="user-audio-container-{{ turn_id }}" class="mt-1">
            </div>
            {% endif %}
            {% if is_conversational %}
            <div id="user-message-feedback-{{ turn_id }}" class="absolute bottom-2.5 right-2.5 group">
                <div class="flex items-center space-x-1.5 px-3 py-1 rounded-full text-xs font-medium bg-gray-700 bg-opacity-90 text-white shadow-sm">
                    <svg class="w-3 h-3 animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span>Analyzing...</span>
                </div>
            </div>
            {% endif %}
        </div>
        <span class="text-xs text-gray-500 mt-1 mr-1">{{ timestamp or "now" }}</span>
    </div>
</div>